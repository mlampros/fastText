<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Language Identification using the 'fastText' package (a Benchmark) • fastText</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Language Identification using the 'fastText' package (a Benchmark)">
<meta property="og:description" content="fastText">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fastText</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/language_identification.html">Language Identification using the 'fastText' package (a Benchmark)</a>
    </li>
    <li>
      <a href="../articles/the_fastText_R_package.html">Functionality of the fastText R package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlampros/fastText/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="language_identification_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Language Identification using the ‘fastText’ package (a Benchmark)</h1>
                        <h4 data-toc-skip class="author">Lampros Mouselimis</h4>
            
            <h4 data-toc-skip class="date">2022-08-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mlampros/fastText/blob/HEAD/vignettes/language_identification.Rmd" class="external-link"><code>vignettes/language_identification.Rmd</code></a></small>
      <div class="hidden name"><code>language_identification.Rmd</code></div>

    </div>

    
    
<p>In this blog post, I’ll explain how to perform <strong>Language Identification</strong> with the <a href="https://github.com/mlampros/fastText" class="external-link">fastText</a> R package and I’ll create a benchmark by including other <em>language identification</em> R packages, i.e. </p>
<ul>
<li>
<a href="https://github.com/ropensci/cld2" class="external-link">cld2</a>, R Wrapper for Google’s Compact Language Detector 2</li>
<li>
<a href="https://github.com/ropensci/cld3" class="external-link">cld3</a>, Bindings to Google’s Compact Language Detector 3</li>
<li>
<a href="https://CRAN.R-project.org/package=textcat" class="external-link">textcat</a>, N-Gram Based Text Categorization</li>
<li>
<a href="https://github.com/gaborcsardi/franc" class="external-link">franc</a>, Port of the JavaScript ‘franc’, Detect the Language of Text</li>
</ul>
<p>I didn’t use any packages that make calls to API’s because the dataset I’ll utilize consists of more than 50.000 thousand observations.</p>
<p>Based on my search on the web, currently, the <a href="https://arxiv.org/abs/1801.07779" class="external-link">WiLI benchmark dataset</a> is among the ones that contain multilingual texts (Wikipedia extracts of 235 languages) and the corresponding labels as well. It can be downloaded either from <a href="https://zenodo.org/record/841984#.YH3BBupRUV1" class="external-link">Zenodo</a> or from my <a href="https://github.com/mlampros/DataSets" class="external-link">Datasets</a> Github repository.</p>
<p>We currently live in the <em>Covid-19 Era</em> and there are many human rights violation incidents (more often than before), therefore I decided to include in this benchmark also the human rights declarations of the 3 most spoken languages (Chinese, Enlish, Spanish) because they are more relevant than ever. The human rights declarations of the mentioned languages can be downloaded either from the <a href="https://www.un.org/en/about-us/universal-declaration-of-human-rights" class="external-link">official website</a> or from my <a href="https://github.com/mlampros/DataSets" class="external-link">Datasets</a> Github repository, and I think it deserves a read from time to time so that we don’t forget our rights as human beings. <br></p>
<div class="section level3">
<h3 id="benchmark-based-on-the-wili-dataset">Benchmark based on the WiLI dataset<a class="anchor" aria-label="anchor" href="#benchmark-based-on-the-wili-dataset"></a>
</h3>
<p>The <em>fastText</em> language identification pre-trained models support currently 176 languages. The following character vector shows the available <em>language isocodes</em>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fasttext_supported_languages</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'af'</span>, <span class="st">'als'</span>, <span class="st">'am'</span>, <span class="st">'an'</span>, <span class="st">'ar'</span>, <span class="st">'arz'</span>, <span class="st">'as'</span>, <span class="st">'ast'</span>, <span class="st">'av'</span>, </span>
<span>                                 <span class="st">'az'</span>, <span class="st">'azb'</span>, <span class="st">'ba'</span>, <span class="st">'bar'</span>, <span class="st">'bcl'</span>, <span class="st">'be'</span>, <span class="st">'bg'</span>, <span class="st">'bh'</span>, <span class="st">'bn'</span>,</span>
<span>                                 <span class="st">'bo'</span>, <span class="st">'bpy'</span>, <span class="st">'br'</span>, <span class="st">'bs'</span>, <span class="st">'bxr'</span>, <span class="st">'ca'</span>, <span class="st">'cbk'</span>, <span class="st">'ce'</span>, <span class="st">'ceb'</span>,</span>
<span>                                 <span class="st">'ckb'</span>, <span class="st">'co'</span>, <span class="st">'cs'</span>, <span class="st">'cv'</span>, <span class="st">'cy'</span>, <span class="st">'da'</span>, <span class="st">'de'</span>, <span class="st">'diq'</span>, <span class="st">'dsb'</span>,</span>
<span>                                 <span class="st">'dty'</span>, <span class="st">'dv'</span>, <span class="st">'el'</span>, <span class="st">'eml'</span>, <span class="st">'en'</span>, <span class="st">'eo'</span>, <span class="st">'es'</span>, <span class="st">'et'</span>, <span class="st">'eu'</span>, </span>
<span>                                 <span class="st">'fa'</span>, <span class="st">'fi'</span>, <span class="st">'fr'</span>, <span class="st">'frr'</span>, <span class="st">'fy'</span>, <span class="st">'ga'</span>, <span class="st">'gd'</span>, <span class="st">'gl'</span>, <span class="st">'gn'</span>, </span>
<span>                                 <span class="st">'gom'</span>, <span class="st">'gu'</span>, <span class="st">'gv'</span>, <span class="st">'he'</span>, <span class="st">'hi'</span>, <span class="st">'hif'</span>, <span class="st">'hr'</span>, <span class="st">'hsb'</span>, <span class="st">'ht'</span>,</span>
<span>                                 <span class="st">'hu'</span>, <span class="st">'hy'</span>, <span class="st">'ia'</span>, <span class="st">'id'</span>, <span class="st">'ie'</span>, <span class="st">'ilo'</span>, <span class="st">'io'</span>, <span class="st">'is'</span>, <span class="st">'it'</span>,</span>
<span>                                 <span class="st">'ja'</span>, <span class="st">'jbo'</span>, <span class="st">'jv'</span>, <span class="st">'ka'</span>, <span class="st">'kk'</span>, <span class="st">'km'</span>, <span class="st">'kn'</span>, <span class="st">'ko'</span>, <span class="st">'krc'</span>,</span>
<span>                                 <span class="st">'ku'</span>, <span class="st">'kv'</span>, <span class="st">'kw'</span>, <span class="st">'ky'</span>, <span class="st">'la'</span>, <span class="st">'lb'</span>, <span class="st">'lez'</span>, <span class="st">'li'</span>, <span class="st">'lmo'</span>,</span>
<span>                                 <span class="st">'lo'</span>, <span class="st">'lrc'</span>, <span class="st">'lt'</span>, <span class="st">'lv'</span>, <span class="st">'mai'</span>, <span class="st">'mg'</span>, <span class="st">'mhr'</span>, <span class="st">'min'</span>, <span class="st">'mk'</span>,</span>
<span>                                 <span class="st">'ml'</span>, <span class="st">'mn'</span>, <span class="st">'mr'</span>, <span class="st">'mrj'</span>, <span class="st">'ms'</span>, <span class="st">'mt'</span>, <span class="st">'mwl'</span>, <span class="st">'my'</span>, <span class="st">'myv'</span>,</span>
<span>                                 <span class="st">'mzn'</span>, <span class="st">'nah'</span>, <span class="st">'nap'</span>, <span class="st">'nds'</span>, <span class="st">'ne'</span>, <span class="st">'new'</span>, <span class="st">'nl'</span>, <span class="st">'nn'</span>, <span class="st">'no'</span>,</span>
<span>                                 <span class="st">'oc'</span>, <span class="st">'or'</span>, <span class="st">'os'</span>, <span class="st">'pa'</span>, <span class="st">'pam'</span>, <span class="st">'pfl'</span>, <span class="st">'pl'</span>, <span class="st">'pms'</span>, <span class="st">'pnb'</span>, </span>
<span>                                 <span class="st">'ps'</span>, <span class="st">'pt'</span>, <span class="st">'qu'</span>, <span class="st">'rm'</span>, <span class="st">'ro'</span>, <span class="st">'ru'</span>, <span class="st">'rue'</span>, <span class="st">'sa'</span>, <span class="st">'sah'</span>, </span>
<span>                                 <span class="st">'sc'</span>, <span class="st">'scn'</span>, <span class="st">'sco'</span>, <span class="st">'sd'</span>, <span class="st">'sh'</span>, <span class="st">'si'</span>, <span class="st">'sk'</span>, <span class="st">'sl'</span>, <span class="st">'so'</span>,</span>
<span>                                 <span class="st">'sq'</span>, <span class="st">'sr'</span>, <span class="st">'su'</span>, <span class="st">'sv'</span>, <span class="st">'sw'</span>, <span class="st">'ta'</span>, <span class="st">'te'</span>, <span class="st">'tg'</span>, <span class="st">'th'</span>, <span class="st">'tk'</span>,</span>
<span>                                 <span class="st">'tl'</span>, <span class="st">'tr'</span>, <span class="st">'tt'</span>, <span class="st">'tyv'</span>, <span class="st">'ug'</span>, <span class="st">'uk'</span>, <span class="st">'ur'</span>, <span class="st">'uz'</span>, <span class="st">'vec'</span>, </span>
<span>                                 <span class="st">'vep'</span>, <span class="st">'vi'</span>, <span class="st">'vls'</span>, <span class="st">'vo'</span>, <span class="st">'wa'</span>, <span class="st">'war'</span>, <span class="st">'wuu'</span>, <span class="st">'xal'</span>, <span class="st">'xmf'</span>,</span>
<span>                                 <span class="st">'yi'</span>, <span class="st">'yo'</span>, <span class="st">'yue'</span>, <span class="st">'zh'</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>For illustration purposes we’ll subset the <em>WiLI dataset</em> to the 2-letter isocodes of the supported fastText languages. For this purpose we’ll use the <a href="https://CRAN.R-project.org/package=ISOcodes" class="external-link">ISOcodes</a> R package and especially the <strong>ISO_639_2</strong> function which includes the required 2- and 3-letter isocodes and also the available full names of the languages,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">isocodes</span> <span class="op">=</span> <span class="fu">ISOcodes</span><span class="fu">::</span><span class="va">ISO_639_2</span></span>
<span><span class="co"># head(isocodes)</span></span>
<span></span>
<span><span class="va">comp_cases</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">isocodes</span><span class="op">$</span><span class="va">Alpha_2</span><span class="op">)</span></span>
<span><span class="va">isocodes_fasttext</span> <span class="op">=</span> <span class="va">isocodes</span><span class="op">[</span><span class="va">comp_cases</span>, <span class="op">]</span></span>
<span><span class="co"># dim(isocodes_fasttext)</span></span>
<span></span>
<span><span class="va">idx_keep_fasttext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">isocodes_fasttext</span><span class="op">$</span><span class="va">Alpha_2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">fasttext_supported_languages</span><span class="op">)</span></span>
<span></span>
<span><span class="va">isocodes_fasttext</span> <span class="op">=</span> <span class="va">isocodes_fasttext</span><span class="op">[</span><span class="va">idx_keep_fasttext</span>, <span class="op">]</span></span>
<span><span class="va">isocodes_fasttext</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">isocodes_fasttext</span><span class="op">)</span></span>
<span><span class="co"># isocodes_fasttext</span></span>
<span></span>
<span><span class="va">lower_nams</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">isocodes_fasttext</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span></span>
<span><span class="va">lower_nams</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">lower_nams</span>, <span class="st">"[;, ]"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span>   <span class="co"># remove second or third naming of the country name</span></span>
<span></span>
<span><span class="va">isocodes_fasttext</span><span class="op">$</span><span class="va">Name_tolower</span> <span class="op">=</span> <span class="va">lower_nams</span></span>
<span><span class="va">isocodes_fasttext</span></span></code></pre></div>
<p><img src="language_identification/isocodes_fasttext.png"></p>
<p><br></p>
<p>The next function will be used to compute and print the accuracy in all cases,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">print_accuracy</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">size_input_data</span>,</span>
<span>                          <span class="va">true_data</span>,</span>
<span>                          <span class="va">preds_data</span>,</span>
<span>                          <span class="va">method</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Total Rows: {size_input_data}"</span><span class="op">)</span>, <span class="st">'\n'</span><span class="op">)</span></span>
<span>  <span class="va">rnd_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">preds_data</span><span class="op">)</span><span class="op">/</span><span class="va">size_input_data</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">msg_2</span> <span class="op">=</span><span class="st">"Predicted Rows: {length(preds_data)}  ({rnd_2 * 100}% predicted)"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="va">msg_2</span><span class="op">)</span>, <span class="st">'\n'</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Missing Values:  {size_input_data - length(preds_data)}"</span><span class="op">)</span>, <span class="st">'\n'</span><span class="op">)</span></span>
<span>  <span class="va">rnd_4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">true_data</span> <span class="op">==</span> <span class="va">preds_data</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">preds_data</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">msg_4</span> <span class="op">=</span> <span class="st">"Accuracy on 'Predicted Rows' using '{method}':  {rnd_4 * 100}%"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="va">msg_4</span><span class="op">)</span>, <span class="st">'\n'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># fasttext language identification supported languages as described in https://fasttext.cc/docs/en/language-identification.html</span></span></code></pre></div>
<p><br></p>
<p>As mentioned earlier the <em>WiLI benchmark dataset</em> can be downloaded either from <a href="https://zenodo.org/record/841984#.YH3BBupRUV1" class="external-link">Zenodo</a> or from my <a href="https://github.com/mlampros/DataSets" class="external-link">Datasets</a> Github repository. Once downloaded and unzipped the folder includes the following files (for the remaining of this blog post I’ll assume that the <strong>dir_wili_2018</strong> variable points to the <em>WiLI</em> data directory ),</p>
<p><img src="language_identification/list_files_willi_2018.png"></p>
<p><br></p>
<p>For this benchmark we’ll use only the <strong>test</strong> data (‘x_test.txt’ and ‘y_test.txt’ files) and we’ll keep only the <em>WiLI-isocodes</em> that intersect with the <em>fastText isocodes</em>,</p>
<p><img src="language_identification/cat_head_willi_2018.png"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="fasttext-based-on-the-smaller-pre-trained-model-lid-176-ftz-approx--917-kb">fastText based on the smaller pre-trained model ‘lid.176.ftz’ (approx. 917 kB)<a class="anchor" aria-label="anchor" href="#fasttext-based-on-the-smaller-pre-trained-model-lid-176-ftz-approx--917-kb"></a>
</h3>
<p><br></p>
<p>First, we’ll use the <a href="https://fasttext.cc/docs/en/language-identification.html" class="external-link">smaller pre-trained dataset</a>,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_ftz</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"language_identification/lid.176.ftz"</span>, package <span class="op">=</span> <span class="st">"fastText"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtbl_res_in</span> <span class="op">=</span> <span class="fu">fastText</span><span class="fu">::</span><span class="fu"><a href="../reference/language_identification.html">language_identification</a></span><span class="op">(</span>input_obj <span class="op">=</span> <span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span>,</span>
<span>                                                pre_trained_language_model_path <span class="op">=</span> <span class="va">file_ftz</span>,</span>
<span>                                                k <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                th <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>                                                threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/dtbl_res_in.png"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtbl_res_in</span><span class="op">$</span><span class="va">true_label</span> <span class="op">=</span> <span class="va">wili_test_y</span><span class="op">$</span><span class="va">V1</span></span>
<span><span class="co"># dtbl_res_in</span></span>
<span></span>
<span><span class="va">isocodes_fasttext_subs</span> <span class="op">=</span> <span class="va">isocodes_fasttext</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>   <span class="co"># merge the predicted labels with the 3-letter isocodes</span></span>
<span></span>
<span><span class="va">merg_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dtbl_res_in</span>, <span class="va">isocodes_fasttext_subs</span>, by.x <span class="op">=</span> <span class="st">'iso_lang_1'</span>, by.y <span class="op">=</span> <span class="st">'Alpha_2'</span><span class="op">)</span></span>
<span><span class="co"># as.vector(colSums(is.na(merg_labels)))</span></span>
<span></span>
<span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wili_test_y</span><span class="op">)</span>, </span>
<span>               true_data <span class="op">=</span> <span class="va">merg_labels</span><span class="op">$</span><span class="va">true_label</span>, </span>
<span>               preds_data <span class="op">=</span> <span class="va">merg_labels</span><span class="op">$</span><span class="va">Alpha_3_B</span>, </span>
<span>               method <span class="op">=</span> <span class="st">'fastText (.ftz pre-trained model)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/print_acc_merg_labels.png"></p>
<p><br></p>
<p>The <strong>accuracy</strong> of the model was <strong>83.05%</strong> (on <strong>50211</strong> out of <strong>50500</strong> text extracts)</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="fasttext-based-on-the-bigger-pre-trained-model-lid-176-bin-approx--126-mb">fastText based on the bigger pre-trained model ‘lid.176.bin’ (approx. 126 MB)<a class="anchor" aria-label="anchor" href="#fasttext-based-on-the-bigger-pre-trained-model-lid-176-bin-approx--126-mb"></a>
</h3>
<p><br></p>
<p>Let’s move to the bigger pre-trained model which is mentioned to be more accurate. This model can be downloaded either from the <a href="https://www.un.org/en/about-us/universal-declaration-of-human-rights" class="external-link">official website</a> or from my <a href="https://github.com/mlampros/DataSets" class="external-link">Datasets</a> Github repository. The parameter setting of the <strong>fastText::language_identification()</strong> function is the same as before, and the only thing that changes is the <strong>pre_trained_language_model_path</strong> parameter which is set to <strong>lid.176.bin</strong>. Assuming this file is downloaded and extracted in the <strong>dir_wili_2018</strong> directory then,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_bin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_wili_2018</span>, <span class="st">'lid.176.bin'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtbl_res_in</span> <span class="op">=</span> <span class="fu">fastText</span><span class="fu">::</span><span class="fu"><a href="../reference/language_identification.html">language_identification</a></span><span class="op">(</span>input_obj <span class="op">=</span> <span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span>,</span>
<span>                                                pre_trained_language_model_path <span class="op">=</span> <span class="va">file_bin</span>,</span>
<span>                                                k <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                th <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>                                                threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/dtbl_res_in_bin.png"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtbl_res_in</span><span class="op">$</span><span class="va">true_label</span> <span class="op">=</span> <span class="va">wili_test_y</span><span class="op">$</span><span class="va">V1</span></span>
<span><span class="co"># dtbl_res_in</span></span>
<span></span>
<span><span class="va">isocodes_fasttext_subs</span> <span class="op">=</span> <span class="va">isocodes_fasttext</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>   <span class="co"># merge the predicted labels with the 3-letter isocodes</span></span>
<span></span>
<span><span class="va">merg_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dtbl_res_in</span>, <span class="va">isocodes_fasttext_subs</span>, by.x <span class="op">=</span> <span class="st">'iso_lang_1'</span>, by.y <span class="op">=</span> <span class="st">'Alpha_2'</span><span class="op">)</span></span>
<span><span class="co"># as.vector(colSums(is.na(merg_labels)))</span></span>
<span></span>
<span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wili_test_y</span><span class="op">)</span>, </span>
<span>               true_data <span class="op">=</span> <span class="va">merg_labels</span><span class="op">$</span><span class="va">true_label</span>, </span>
<span>               preds_data <span class="op">=</span> <span class="va">merg_labels</span><span class="op">$</span><span class="va">Alpha_3_B</span>, </span>
<span>               method <span class="op">=</span> <span class="st">'fastText (.ftz pre-trained model)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/print_acc_merg_labels_bin.png"></p>
<p><br></p>
<p>The <strong>accuracy</strong> based on the bigger model was increased to <strong>86.55%</strong> (on <strong>50168</strong> out of <strong>50500</strong> text extracts)</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="ggplot-visualization-of-the-bigger--bin-model">ggplot visualization of the bigger .bin model<a class="anchor" aria-label="anchor" href="#ggplot-visualization-of-the-bigger--bin-model"></a>
</h3>
<p><br></p>
<p>The following plot shows the confusion matrix of the bigger .bin model. The main diagonal is dominated by the dark green color indicating higher accuracy rates,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">merg_labels</span><span class="op">$</span><span class="va">true_label</span>, <span class="va">merg_labels</span><span class="op">$</span><span class="va">Alpha_3_B</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.data.frame.table</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'country_vert'</span>, <span class="st">'country_horiz'</span>, <span class="st">'Freq'</span><span class="op">)</span></span>
<span><span class="co"># head(df)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country_vert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">country_vert</span><span class="op">)</span>,                 <span class="co"># alphabetical order by default</span></span>
<span>         country_horiz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">country_horiz</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">country_horiz</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt_tbl</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">country_vert</span>, y<span class="op">=</span><span class="va">country_horiz</span>, fill<span class="op">=</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Greens"</span>, direction<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">1.0</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>    </span>
<span></span>
<span><span class="va">plt_tbl</span></span></code></pre></div>
<p><img src="language_identification/fasttext_benchmark_confussion_matr.png"><br></p>
</div>
<div class="section level3">
<h3 id="cld2-language-recognition-package">‘cld2’ language recognition package<a class="anchor" aria-label="anchor" href="#cld2-language-recognition-package"></a>
</h3>
<p><br></p>
<p>The <strong>Google’s Compact Language Detector 2</strong> (CLD2) " … probabilistically detects over 80 languages in Unicode UTF-8 text, either plain text or HTML/XML. For mixed-language input, CLD2 returns the top three languages found and their approximate percentages of the total text bytes (e.g. 80% English and 20% French out of 1000 bytes) …“. Based on the R package documentation,”The function ‘detect_language()’ is vectorised and guesses the language of each string in text or returns NA if the language could not reliably be determined."</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/cld2/" class="external-link">cld2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_start</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cld2_vec</span> <span class="op">=</span> <span class="fu">cld2</span><span class="fu">::</span><span class="fu">detect_language</span><span class="op">(</span>text <span class="op">=</span> <span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span>, plain_text <span class="op">=</span> <span class="cn">TRUE</span>, lang_code <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cld2_dtbl</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Alpha_2 <span class="op">=</span> <span class="va">cld2_vec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cld2_dtbl</span><span class="op">$</span><span class="va">true_label</span> <span class="op">=</span> <span class="va">wili_test_y</span><span class="op">$</span><span class="va">V1</span></span>
<span></span>
<span><span class="va">merg_labels_cld2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">cld2_dtbl</span>, <span class="va">isocodes_fasttext_subs</span>, by <span class="op">=</span> <span class="st">'Alpha_2'</span><span class="op">)</span></span>
<span><span class="co"># as.vector(colSums(is.na(merg_labels_cld2)))</span></span>
<span></span>
<span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wili_test_y</span><span class="op">)</span>,</span>
<span>               true_data <span class="op">=</span> <span class="va">merg_labels_cld2</span><span class="op">$</span><span class="va">true_label</span>,</span>
<span>               preds_data <span class="op">=</span> <span class="va">merg_labels_cld2</span><span class="op">$</span><span class="va">Alpha_3_B</span>,</span>
<span>               method <span class="op">=</span> <span class="st">'cld2'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/merg_labels_cld2.png"></p>
<p><br></p>
<p>The <strong>accuracy</strong> of the <strong>cld2</strong> package is <strong>83.13%</strong> (on <strong>34254</strong> out of <strong>50500</strong> text extracts)</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="cld3-language-recognition-package">‘cld3’ language recognition package<a class="anchor" aria-label="anchor" href="#cld3-language-recognition-package"></a>
</h3>
<p><br></p>
<p>The " … Google’s Compact Language Detector 3 is a neural network model for language identification and the successor of CLD2 (available from) CRAN. This version is still experimental and uses a novell algorithm with different properties and outcomes. For more information see: <a href="https://github.com/google/cld3#readme" class="external-link uri">https://github.com/google/cld3#readme</a> …“. Based on the R package documentation,”The function detect_language() is vectorised and guesses the language of each string in text or returns NA if the language could not reliably be determined."</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/cld3/" class="external-link">cld3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_start</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cld3_vec</span> <span class="op">=</span> <span class="fu">cld3</span><span class="fu">::</span><span class="fu">detect_language</span><span class="op">(</span>text <span class="op">=</span> <span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cld3_dtbl</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Alpha_2 <span class="op">=</span> <span class="va">cld3_vec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cld3_dtbl</span><span class="op">$</span><span class="va">true_label</span> <span class="op">=</span> <span class="va">wili_test_y</span><span class="op">$</span><span class="va">V1</span></span>
<span></span>
<span><span class="va">merg_labels_cld3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">cld3_dtbl</span>, <span class="va">isocodes_fasttext_subs</span>, by <span class="op">=</span> <span class="st">'Alpha_2'</span><span class="op">)</span></span>
<span><span class="co"># as.vector(colSums(is.na(merg_labels_cld3)))</span></span>
<span></span>
<span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wili_test_y</span><span class="op">)</span>,</span>
<span>               true_data <span class="op">=</span> <span class="va">merg_labels_cld3</span><span class="op">$</span><span class="va">true_label</span>,</span>
<span>               preds_data <span class="op">=</span> <span class="va">merg_labels_cld3</span><span class="op">$</span><span class="va">Alpha_3_B</span>, </span>
<span>               method <span class="op">=</span> <span class="st">'cld3'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/merg_labels_cld3.png"></p>
<p><br></p>
<p>The <strong>accuracy</strong> of the <strong>cld3</strong> package is <strong>74.74%</strong> (on <strong>43560</strong> out of <strong>50500</strong> text extracts)</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="language-recognition-using-the-textcat-r-package">Language recognition using the ‘textcat’ R package<a class="anchor" aria-label="anchor" href="#language-recognition-using-the-textcat-r-package"></a>
</h3>
<p><br></p>
<p>The ‘textcat’ R package performs ‘text categorization based on n-grams’. The documentation of the package mentions: "… TextCat (<a href="https://www.let.rug.nl/vannoord/TextCat/" class="external-link uri">https://www.let.rug.nl/vannoord/TextCat/</a>) is a Perl implementation of the Cavnarand Trenkle ‘N-Gram-Based Text Categorization’ technique by Gertjan van Noord which was subsequently integrated into SpamAssassin. It provides byte n-gram profiles for 74 ‘languages’ (more precisely, language/encoding combinations). The C library reimplementation libtextcat (<a href="https://software.wise-guys.nl/libtextcat/" class="external-link uri">https://software.wise-guys.nl/libtextcat/</a>) adds one more non-empty profile.</p>
<ul>
<li>‘TC_byte_profiles’ provides these byte profiles.</li>
<li>‘TC_char_profiles’ provides a subset of 56 character profiles obtained by converting the byte sequences to UTF-8 strings where possible.</li>
</ul>
<p>The category ids are unchanged from the original, and give the full (English) name of the language, optionally combined the name of the encoding script. Note that ‘scots’ indicates Scots, the Germanic language variety historically spoken in Lowland Scotland and parts of Ulster, to be distinguished from Scottish Gaelic (named ‘scots_gaelic’ in the profiles), the Celtic language variety spoken in most of the western Highlands and in the Hebrides (see <a href="https://en.wikipedia.org/wiki/Scots_language" class="external-link uri">https://en.wikipedia.org/wiki/Scots_language</a>) …"</p>
<p><br></p>
<p>Apart from the previous 2 mentioned TC-profiles the <strong>ECIMCI_profiles</strong> (26 profiles) also exists. In my benchmark I’ll use only the <em>‘TC_byte_profile’</em> (75 profiles) and <em>‘TC_char_profiles’</em> (56 profiles) as input to the <strong>textcat()</strong> function to compute the country names, which by default the <em>textcat()</em> function returns. I’ll wrap the function to <strong>parallel::mclapply()</strong> because I observed it returns the results faster using multiple threads (in my benchmark I used 8 threads).</p>
<p><br></p>
<div class="section level4">
<h4 id="using-the-tc_byte_profiles">using the ‘TC_byte_profiles’<a class="anchor" aria-label="anchor" href="#using-the-tc_byte_profiles"></a>
</h4>
<p><br></p>
<p>Before proceeding lets have a look to the available profiles,</p>
<p><br></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threads</span> <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">textcat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">textcat</span><span class="fu">::</span><span class="va">TC_byte_profiles</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/names_tc_byte_profiles.png"></p>
<p><br></p>
<p>What we want is that the initial <em>lowercase isocodes</em> intersect with the processed <em>TC_byte_profiles</em> so that the computation of the accuracy is correct,</p>
<p><img src="language_identification/nams_profiles.png"></p>
<p><br></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_start</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">textcat</span><span class="op">(</span>x <span class="op">=</span> <span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, p <span class="op">=</span> <span class="fu">textcat</span><span class="fu">::</span><span class="va">TC_byte_profiles</span>, method <span class="op">=</span> <span class="st">"CT"</span><span class="op">)</span></span>
<span><span class="op">}</span>, mc.cores <span class="op">=</span> <span class="va">threads</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">textc</span>, <span class="st">'-'</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">textc</span>, which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">textc</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/unique_textc.png"></p>
<p><br></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">textc_dtbl</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Name_tolower <span class="op">=</span> <span class="va">textc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">textc_dtbl</span><span class="op">$</span><span class="va">true_label</span> <span class="op">=</span> <span class="va">wili_test_y</span><span class="op">$</span><span class="va">V1</span></span>
<span></span>
<span><span class="va">fasttext_isoc_name</span> <span class="op">=</span> <span class="va">isocodes_fasttext</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">merg_labels_textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">textc_dtbl</span>, <span class="va">fasttext_isoc_name</span>, by <span class="op">=</span> <span class="st">'Name_tolower'</span><span class="op">)</span></span>
<span><span class="co"># as.vector(colSums(is.na(merg_labels_cld2)))</span></span>
<span></span>
<span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wili_test_y</span><span class="op">)</span>, </span>
<span>               true_data <span class="op">=</span> <span class="va">merg_labels_textc</span><span class="op">$</span><span class="va">true_label</span>,</span>
<span>               preds_data <span class="op">=</span> <span class="va">merg_labels_textc</span><span class="op">$</span><span class="va">Alpha_3_B</span>,</span>
<span>               method <span class="op">=</span> <span class="st">'textcat ( TC_byte_profiles )'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/merg_labels_textc.png"></p>
<p><br></p>
<p>The <strong>accuracy</strong> of the <strong>textcat</strong> package using the <strong>TC_byte_profiles</strong> is <strong>29.91%</strong> (on <strong>47324</strong> out of <strong>50500</strong> text extracts)</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="using-the-tc_char_profiles">using the ‘TC_char_profiles’<a class="anchor" aria-label="anchor" href="#using-the-tc_char_profiles"></a>
</h4>
<p><br></p>
<p>Again, as previously we can have a look to the available profiles,</p>
<p><br></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">textcat</span><span class="fu">::</span><span class="va">TC_char_profiles</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/names_tc_char_profiles.png"></p>
<p><br></p>
<p>What we want is that the initial <em>lowercase isocodes</em> intersect with the processed <em>TC_char_profiles</em> so that the computation of the accuracy is correct,</p>
<p><img src="language_identification/nams_profiles_char.png"></p>
<p><br></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_start</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">textcat</span><span class="op">(</span>x <span class="op">=</span> <span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, p <span class="op">=</span> <span class="fu">textcat</span><span class="fu">::</span><span class="va">TC_char_profiles</span>, method <span class="op">=</span> <span class="st">"CT"</span><span class="op">)</span></span>
<span><span class="op">}</span>, mc.cores <span class="op">=</span> <span class="va">threads</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">textc</span>, <span class="st">'-'</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">textc</span>, which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">textc</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/unique_textc_char.png"></p>
<p><br></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">textc_dtbl</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Name_tolower <span class="op">=</span> <span class="va">textc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">textc_dtbl</span><span class="op">$</span><span class="va">true_label</span> <span class="op">=</span> <span class="va">wili_test_y</span><span class="op">$</span><span class="va">V1</span></span>
<span></span>
<span><span class="va">fasttext_isoc_name</span> <span class="op">=</span> <span class="va">isocodes_fasttext</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">merg_labels_textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">textc_dtbl</span>, <span class="va">fasttext_isoc_name</span>, by <span class="op">=</span> <span class="st">'Name_tolower'</span><span class="op">)</span></span>
<span><span class="co"># as.vector(colSums(is.na(merg_labels_cld2)))</span></span>
<span></span>
<span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wili_test_y</span><span class="op">)</span>, </span>
<span>               true_data <span class="op">=</span> <span class="va">merg_labels_textc</span><span class="op">$</span><span class="va">true_label</span>,</span>
<span>               preds_data <span class="op">=</span> <span class="va">merg_labels_textc</span><span class="op">$</span><span class="va">Alpha_3_B</span>,</span>
<span>               method <span class="op">=</span> <span class="st">'textcat ( TC_char_profiles )'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/merg_labels_textc_char.png"></p>
<p><br></p>
<p>The <strong>accuracy</strong> of the <strong>textcat</strong> package using the <strong>TC_char_profiles</strong> is <strong>31.10%</strong> (on <strong>43265</strong> out of <strong>50500</strong> text extracts)</p>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="language-recognition-using-the-franc-r-package">Language recognition using the ‘franc’ R package<a class="anchor" aria-label="anchor" href="#language-recognition-using-the-franc-r-package"></a>
</h3>
<p><br></p>
<p>The <a href="https://github.com/gaborcsardi/franc" class="external-link">R package port of Franc</a> has no external dependencies and supports <em>310 languages</em>. All languages spoken by more than one million speakers. Franc is a port of the <a href="https://github.com/wooorm/franc" class="external-link">JavaScript project</a> of the same name. Based on the documentation of the <a href="https://github.com/wooorm/franc" class="external-link">JavaScript project</a>, <em>" … franc supports many languages, which means it’s easily confused on small samples. Make sure to pass it big documents to get reliable results …"</em></p>
<p><br></p>
<p>The <strong>franc()</strong> function expects a text extract, therefore we will wrap the function with <strong>parallel::mclapply()</strong> as we’ve done with the <em>textcat</em> package to reduce the computation time. Moreover, we’ll set the <strong>min_speakers</strong> parameter to <strong>0</strong> to include <strong>all</strong> languages known by franc (increasing the <em>max_length</em> parameter to <em>4096</em> does not improve the accuracy for this specific data / text extracts),</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/franc#readme" class="external-link">franc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_start</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">franc_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">franc</span><span class="op">(</span>text <span class="op">=</span> <span class="va">wili_test_x</span><span class="op">$</span><span class="va">V1</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, min_speakers <span class="op">=</span> <span class="fl">0</span>, min_length <span class="op">=</span> <span class="fl">10</span>, max_length <span class="op">=</span> <span class="fl">2048</span><span class="op">)</span></span>
<span><span class="op">}</span>, mc.cores <span class="op">=</span> <span class="va">threads</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">franc_dtbl</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>franc <span class="op">=</span> <span class="va">franc_res</span>, true_label <span class="op">=</span> <span class="va">wili_test_y</span><span class="op">$</span><span class="va">V1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># as.vector(colSums(is.na(franc_dtbl)))</span></span>
<span></span>
<span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wili_test_y</span><span class="op">)</span>, </span>
<span>               true_data <span class="op">=</span> <span class="va">franc_dtbl</span><span class="op">$</span><span class="va">true_label</span>, </span>
<span>               preds_data <span class="op">=</span> <span class="va">franc_dtbl</span><span class="op">$</span><span class="va">franc</span>, </span>
<span>               method <span class="op">=</span> <span class="st">'franc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/franc_res.png"></p>
<p><br></p>
<p>The <strong>accuracy</strong> of the <strong>franc</strong> package is <strong>62.04%</strong> (on <strong>50500</strong> out of <strong>50500</strong> text extracts)</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="overview-datatable-of-all-methods">Overview datatable of all methods<a class="anchor" aria-label="anchor" href="#overview-datatable-of-all-methods"></a>
</h3>
<p><br></p>
<p>Sorted by <strong>Accuracy</strong> (highest better),</p>
<p><img src="language_identification/accuracy.png"></p>
<p><br></p>
<p>Sorted by <strong>predicted percentage of text extracts</strong> (highest better),</p>
<p><img src="language_identification/percentage.png"></p>
<p><br></p>
<p>Sorted by <strong>missing values</strong> (lowest better),</p>
<p><img src="language_identification/missing.png"></p>
<p><br></p>
<p>Sorted by <strong>computation time</strong> (lowest better),</p>
<p><img src="language_identification/time.png"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="benchmark-based-on-the-human-rights-declaration-files">Benchmark based on the Human Rights Declaration files<a class="anchor" aria-label="anchor" href="#benchmark-based-on-the-human-rights-declaration-files"></a>
</h3>
<p><br></p>
<p>We can test the mentioned functions also using the <strong>Declaration of Human Rights</strong> text files, which are smaller in size and can give hints on potential misclassifications. As I mentioned at the beginning of this blog post the data can be downloaded from two different internet sources. I’ll use only 3 files from the <em>official website</em> based on the <strong>total number of speakers worldwide</strong> (the first 3 are: <strong>Chinese</strong>, <strong>English</strong>, <strong>Spanish</strong>) and you can see the full list of the most spoken languages worldwide in the correponding <a href="https://en.wikipedia.org/wiki/List_of_languages_by_total_number_of_speakers" class="external-link">wikipedia article</a>.</p>
<p>Assuming the <strong>.zip</strong> file is downloaded and extracted in the <strong>dir_wili_2018</strong> directory and the folder name that includes the files is named as <strong>declaration_human_rights</strong> then,</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir_files</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_wili_2018</span>, <span class="st">'declaration_human_rights'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lst_files</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir_files</span>, full.names <span class="op">=</span> <span class="cn">T</span>, pattern <span class="op">=</span> <span class="st">'.pdf'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">decl_dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lst_files</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">iter_dat</span> <span class="op">=</span> <span class="fu">pdftools</span><span class="fu">::</span><span class="fu">pdf_text</span><span class="op">(</span>pdf <span class="op">=</span> <span class="va">lst_files</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">lang</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">'.pdf'</span>, <span class="st">''</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">lst_files</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="st">'_'</span><span class="op">)</span><span class="op">)</span>, which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span></span>
<span>  <span class="va">lang</span> <span class="op">=</span> <span class="va">lang</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lang</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">vec_txt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">iter_dat</span>, which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">vec_txt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">vec_txt</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">'\n'</span>, <span class="st">''</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">idx_lang</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">isocodes_fasttext</span><span class="op">$</span><span class="va">Name_tolower</span> <span class="op">==</span> <span class="va">lang</span><span class="op">)</span></span>
<span>  <span class="va">isocode_3_language</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">isocodes_fasttext</span><span class="op">$</span><span class="va">Alpha_3_B</span><span class="op">[</span><span class="va">idx_lang</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vec_txt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">isocode_2_language</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">isocodes_fasttext</span><span class="op">$</span><span class="va">Alpha_2</span><span class="op">[</span><span class="va">idx_lang</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vec_txt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">language</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">lang</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vec_txt</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">dtbl</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>isocode_3_language <span class="op">=</span> <span class="va">isocode_3_language</span>,</span>
<span>                                isocode_2_language <span class="op">=</span> <span class="va">isocode_2_language</span>,</span>
<span>                                language <span class="op">=</span> <span class="va">language</span>,</span>
<span>                                text <span class="op">=</span> <span class="va">vec_txt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dtbl</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">decl_dat</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/decl_dat.png"></p>
<p><br></p>
<p>The output <em>data.table</em> includes besides the <em>language</em> also the language <em>isocodes</em> (consisting of 2 and 3 letters) and the <em>text extracts</em>. We can start to identify the language of these extracts using the <strong>fastText</strong> R package and utilizing the <em>small</em> pre-trained <em>‘lid.176.ftz’</em> model,</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtbl_res_in</span> <span class="op">=</span> <span class="fu">fastText</span><span class="fu">::</span><span class="fu"><a href="../reference/language_identification.html">language_identification</a></span><span class="op">(</span>input_obj <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">text</span>,</span>
<span>                                                pre_trained_language_model_path <span class="op">=</span> <span class="va">file_ftz</span>,</span>
<span>                                                k <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                th <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>                                                threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/dtbl_res_in_decl.png"></p>
<p><br></p>
<p>To validate the results we will use the <strong>isocode_2_language</strong> column of the previous computed <strong>decl_dat</strong> data.table,</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dtbl_res_in</span><span class="op">$</span><span class="va">iso_lang_1</span><span class="op">)</span>,</span>
<span>               true_data <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">isocode_2_language</span>,</span>
<span>               preds_data <span class="op">=</span> <span class="va">dtbl_res_in</span><span class="op">$</span><span class="va">iso_lang_1</span>,</span>
<span>               method <span class="op">=</span> <span class="st">'fastText (.ftz pre-trained model)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/dtbl_res_in_decl_acc.png"></p>
<p>There are no misclassifications for the 24 input text extracts using the <em>fastText</em> algorithm. We can move to the <strong>cld2</strong> R package and the corresponding language identification function,</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cld2_vec</span> <span class="op">=</span> <span class="fu">cld2</span><span class="fu">::</span><span class="fu">detect_language</span><span class="op">(</span>text <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">text</span>, </span>
<span>                                 plain_text <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                 lang_code <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">cld2_vec</span></span></code></pre></div>
<p><img src="language_identification/cld2_vec.png"></p>
<p><br></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span>, </span>
<span>               true_data <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">isocode_2_language</span>, </span>
<span>               preds_data <span class="op">=</span> <span class="va">cld2_vec</span>, </span>
<span>               method <span class="op">=</span> <span class="st">'cld2'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/cld2_vec_acc.png"></p>
<p>There are no misclassifications for the <strong>cld2</strong> algorithm too. We’ll test also <strong>cld3</strong>,</p>
<p><br></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cld3_vec</span> <span class="op">=</span> <span class="fu">cld3</span><span class="fu">::</span><span class="fu">detect_language</span><span class="op">(</span>text <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">text</span><span class="op">)</span></span>
<span><span class="va">cld3_vec</span></span></code></pre></div>
<p><img src="language_identification/cld3_vec.png"></p>
<p><br></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span>,</span>
<span>               true_data <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">isocode_2_language</span>,</span>
<span>               preds_data <span class="op">=</span> <span class="va">cld3_vec</span>,</span>
<span>               method <span class="op">=</span> <span class="st">'cld3'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/cld3_vec_acc.png"></p>
<p>There are no misclassifications for the <strong>cld3</strong> algorithm, so we move to the <strong>textcat</strong> R package. The <strong>‘TC_byte_profiles’</strong> include the <strong>‘chinese-gb2312’</strong> language characters therefore we’ll use these profiles in the <strong>textcat</strong> function,</p>
<p><br></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">textc</span> <span class="op">=</span> <span class="fu">textcat</span><span class="op">(</span>x <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">text</span>, p <span class="op">=</span> <span class="fu">textcat</span><span class="fu">::</span><span class="va">TC_byte_profiles</span>, method <span class="op">=</span> <span class="st">"CT"</span><span class="op">)</span> </span>
<span><span class="va">textc</span></span></code></pre></div>
<p><img src="language_identification/textc_decl_iso.png"></p>
<p><br></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">textc</span>, <span class="st">'-'</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">textc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">textc</span>, which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span></span>
<span><span class="va">textc</span></span></code></pre></div>
<p><img src="language_identification/textc_decl_iso_trim.png"></p>
<p><br></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span>, </span>
<span>               true_data <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">language</span>, </span>
<span>               preds_data <span class="op">=</span> <span class="va">textc</span>, </span>
<span>               method <span class="op">=</span> <span class="st">'textcat'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/textc_decl_acc.png"></p>
<p>The <strong>textcat</strong> package misclassifies the <em>chinese text extracts</em> as <em>‘japanese-shift_jis’</em>, therefore the accuracy <em>drops to approx. 70%</em>. Finally, we’ll test the <strong>franc</strong> package,</p>
<p><br></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">franc_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">$</span><span class="va">text</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">franc</span><span class="op">(</span>text <span class="op">=</span> <span class="va">x</span>, min_length <span class="op">=</span> <span class="fl">10</span>, max_length <span class="op">=</span> <span class="fl">2048</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">franc_vec</span></span></code></pre></div>
<p><img src="language_identification/franc_vec_decl.png"></p>
<p><br></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print_accuracy</span><span class="op">(</span>size_input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span>,</span>
<span>               true_data <span class="op">=</span> <span class="va">decl_dat</span><span class="op">$</span><span class="va">isocode_3_language</span>,</span>
<span>               preds_data <span class="op">=</span> <span class="va">franc_vec</span>,</span>
<span>               method <span class="op">=</span> <span class="st">'franc'</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/franc_vec_decl_acc.png"></p>
<p>The <strong>franc</strong> function identified the <em>chinese</em> text excerpts as <em>mandarin</em> chinese, therefore I personally would not consider these as misclassifications (as <em>mandarin</em> is a dialect of the chinese language). We can have an overview of the results of the different methods by illustrating the outputs in a single data.table,</p>
<p><br></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtbl_out</span> <span class="op">=</span> <span class="va">decl_dat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dtbl_out</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'true_y_iso_3'</span>, <span class="st">'true_y_iso_2'</span>, <span class="st">'true_y_language'</span><span class="op">)</span></span>
<span><span class="co"># dtbl_out</span></span>
<span></span>
<span><span class="va">dtbl_preds</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fastText <span class="op">=</span> <span class="va">dtbl_res_in</span><span class="op">$</span><span class="va">iso_lang_1</span>,</span>
<span>                                    cld2 <span class="op">=</span> <span class="va">cld2_vec</span>,</span>
<span>                                    cld3 <span class="op">=</span> <span class="va">cld3_vec</span>,</span>
<span>                                    textcat <span class="op">=</span> <span class="va">textc</span>,</span>
<span>                                    franc <span class="op">=</span> <span class="va">franc_vec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># dtbl_preds</span></span>
<span></span>
<span><span class="va">dtbl_out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dtbl_out</span>, <span class="va">dtbl_preds</span><span class="op">)</span></span>
<span><span class="va">dtbl_out</span></span></code></pre></div>
<p><img src="language_identification/dtbl_out_decl.png"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="comparison-between-fasttext-cl2-cl3-and-franc-for-multilingual-output">Comparison between ‘fastText’, ‘cl2’, ‘cl3’ and ‘franc’ for Multilingual output<a class="anchor" aria-label="anchor" href="#comparison-between-fasttext-cl2-cl3-and-franc-for-multilingual-output"></a>
</h3>
<p><br></p>
<p>Finally, we can observe the output of <strong>fastText</strong>, <strong>cl2</strong>, <strong>cl3</strong> and <strong>franc</strong> for Multilingual output (I’ll exclude the <strong>textcat::textcat()</strong> function, because it expects a single language per character string in the input vector).</p>
<ul>
<li>We will first tokenize all three <strong>Declaration of Human Rights</strong> text files, then</li>
<li>we will sample a specific number of words of the tokenized output and</li>
<li>build a sentence that will be classified using the mentioned algorithms.</li>
</ul>
<p>In order to verify the results and see how each algorithm performs we will pick <strong>100 words</strong> of each declaration file. Due to the fact that the <strong>chinese</strong> language has <strong>ambiguous word boundaries</strong> we will use the <strong>stringi::stri_split_boundaries()</strong> function of the <strong>stringi</strong> R package to extract the words of the chinese text file. The following function shows the pre-processing steps to come to the multilingual sentence,</p>
<p><br></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lst_files</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir_files</span>, full.names <span class="op">=</span> <span class="cn">F</span>, pattern <span class="op">=</span> <span class="st">'.pdf'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">min_letters_en_es</span> <span class="op">=</span> <span class="fl">3</span>         <span class="co"># min. number of characters for the 'en' and 'es' languages</span></span>
<span><span class="va">sample_words</span> <span class="op">=</span> <span class="fl">100</span>            <span class="co"># sample that many words from each tokenized file</span></span>
<span></span>
<span><span class="va">decl_dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lst_files</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">iter_dat</span> <span class="op">=</span> <span class="fu">pdftools</span><span class="fu">::</span><span class="fu">pdf_text</span><span class="op">(</span>pdf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_files</span>, <span class="va">lst_files</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">dat_txt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">iter_dat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">lst_files</span><span class="op">[</span><span class="va">x</span><span class="op">]</span> <span class="op">==</span> <span class="st">'declaration_human_rights_chinese.pdf'</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">res_spl_lang</span> <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_split_boundaries.html" class="external-link">stri_split_boundaries</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                                    type <span class="op">=</span> <span class="st">'word'</span>, </span>
<span>                                                    skip_word_none <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                                    skip_word_letter <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                                    skip_word_number <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">res_spl_lang</span> <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_split.html" class="external-link">stri_split</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                         regex <span class="op">=</span> <span class="st">'[ \n,]'</span>,</span>
<span>                                         omit_empty <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                         tokens_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">res_spl_lang</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">res_spl_lang</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, which <span class="op">=</span> <span class="st">'both'</span><span class="op">)</span></span>
<span>    <span class="va">idx_empty</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">res_spl_lang</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">idx_empty</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">res_spl_lang</span> <span class="op">=</span> <span class="va">res_spl_lang</span><span class="op">[</span><span class="op">-</span><span class="va">idx_empty</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">min_letters_en_es</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">lst_files</span><span class="op">[</span><span class="va">x</span><span class="op">]</span> <span class="op">!=</span> <span class="st">'declaration_human_rights_chinese.pdf'</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">nchars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">res_spl_lang</span><span class="op">)</span></span>
<span>      <span class="va">idx_chars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">nchars</span> <span class="op">&gt;=</span> <span class="va">min_letters_en_es</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">idx_chars</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">res_spl_lang</span> <span class="op">=</span> <span class="va">res_spl_lang</span><span class="op">[</span><span class="va">idx_chars</span><span class="op">]</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">res_spl_lang</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">dat_txt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">dat_txt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">sample_words</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">dat_txt</span>, <span class="va">sample_words</span><span class="op">)</span></span>
<span>  <span class="va">sample_words</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">decl_dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">decl_dat</span> <span class="op">=</span> <span class="va">decl_dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">decl_dat</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">multilingual_sentence</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">decl_dat</span>, collapse <span class="op">=</span> <span class="st">' '</span><span class="op">)</span></span>
<span><span class="va">multilingual_sentence</span></span></code></pre></div>
<p><img src="language_identification/multilingual_sentence.png"></p>
<p><br></p>
<p>We deliberately mixed the words by first sampling the vector and then concatenating the tokens to a sentence. The purpose of the multilingual identification is to find out if each algorithm detects the <em>correct languages</em> assuming the <em>number of languages</em> in the text are <em>known beforehand</em>.</p>
<p>Imagine, you have 3 people having a conversation in a room where interchangeably a different language is spoken and this conversation is recorded by a fourth person.</p>
<p><br></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_languages</span> <span class="op">=</span> <span class="fl">3</span></span></code></pre></div>
<p><br></p>
<div class="section level4">
<h4 id="fasttext-multilingual">
<strong>fastText Multilingual</strong><a class="anchor" aria-label="anchor" href="#fasttext-multilingual"></a>
</h4>
<p><br></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtbl_multiling</span> <span class="op">=</span> <span class="fu">fastText</span><span class="fu">::</span><span class="fu"><a href="../reference/language_identification.html">language_identification</a></span><span class="op">(</span>input_obj <span class="op">=</span> <span class="va">multilingual_sentence</span>,</span>
<span>                                                   pre_trained_language_model_path <span class="op">=</span> <span class="va">file_ftz</span>,</span>
<span>                                                   k <span class="op">=</span> <span class="va">num_languages</span>,</span>
<span>                                                   th <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>                                                   threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dtbl_multiling</span></span></code></pre></div>
<p><img src="language_identification/dtbl_multiling.png"></p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="cld2-multilingual">
<strong>cld2 Multilingual</strong><a class="anchor" aria-label="anchor" href="#cld2-multilingual"></a>
</h4>
<p><br></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cld2</span><span class="fu">::</span><span class="fu">detect_language_mixed</span><span class="op">(</span>text <span class="op">=</span> <span class="va">multilingual_sentence</span>, plain_text <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">classification</span></span></code></pre></div>
<p><img src="language_identification/dtbl_multiling_cld2.png"></p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="cld3-multilingual">
<strong>cld3 Multilingual</strong><a class="anchor" aria-label="anchor" href="#cld3-multilingual"></a>
</h4>
<p><br></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cld3</span><span class="fu">::</span><span class="fu">detect_language_mixed</span><span class="op">(</span>text <span class="op">=</span> <span class="va">multilingual_sentence</span>, size <span class="op">=</span> <span class="va">num_languages</span><span class="op">)</span></span></code></pre></div>
<p><img src="language_identification/dtbl_multiling_cld3.png"></p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="franc-multilingual">
<strong>franc Multilingual</strong><a class="anchor" aria-label="anchor" href="#franc-multilingual"></a>
</h4>
<p><br></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we could use the 'whitelist' parameter but the purpose is to identify languages from unknown text</span></span>
<span></span>
<span><span class="fu">franc</span><span class="fu">::</span><span class="fu">franc_all</span><span class="op">(</span>text <span class="op">=</span> <span class="va">multilingual_sentence</span>, max_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">multilingual_sentence</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">num_languages</span>, <span class="op">]</span></span></code></pre></div>
<p><img src="language_identification/dtbl_multiling_franc.png"></p>
<p><br></p>
<p>From the results one can come to the following <strong>conclusions</strong>:</p>
<ul>
<li>the <strong>cld2</strong> <em>detect_language_mixed()</em> function detects the correct languages without even specifying how many languages are in the text</li>
<li>the <strong>cld3</strong> <em>detect_language_mixed()</em> function detects the correct languages (as <em>cld2</em>) but with the <em>limitation</em> that we have to specify the number of languages beforehand</li>
<li>the <strong>fastText</strong> function, detects 2 out of the 3 languages and the false detected one (<em>japanese</em>) seems to receive a higher probability than <em>chinese</em> (<em>english</em> is not detected at all)</li>
<li>the <strong>franc</strong> <em>franc_all()</em> function detects correctly 2 out of the 3 languages (<em>english</em> and <em>spanish</em>) but not chinese (the third language based on score is <em>Galician</em>)</li>
</ul>
<p><br></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lampros Mouselimis.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
